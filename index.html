<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type to Learn: Alien Invasion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
        }
        .game-title {
            font-family: 'Press Start 2P', cursive;
        }
        .game-container {
            position: relative;
        }
        canvas {
            background-color: #0c0a09; /* stone-950 */
            border-radius: 8px;
            display: block;
            width: 100%;
            height: auto;
            aspect-ratio: 800 / 350;
        }
        .overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(12, 10, 9, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            text-align: center;
        }
        .overlay.show {
            display: flex;
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        @media (min-width: 640px) {
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto bg-gray-800 rounded-xl shadow-2xl shadow-blue-500/20 p-6 md:p-8 border border-gray-700">
        <h1 class="game-title text-3xl md:text-4xl font-bold text-center text-blue-400 mb-2">Type Invaders</h1>
        
        <!-- Main Game Container (initially hidden) -->
        <div id="main-game-container" class="hidden">
            <p class="text-center text-gray-400 mb-6">Survive as many waves as you can!</p>
            <div class="game-container mb-6">
                <canvas id="game-canvas"></canvas>
                <!-- Wave Cleared Screen -->
                <div id="wave-cleared-overlay" class="overlay">
                    <h2 id="wave-cleared-title" class="game-title text-2xl md:text-4xl font-bold text-green-400 mb-6">Wave 1 Cleared!</h2>
                    <button id="next-wave-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg shadow-lg text-xl md:text-2xl transition-transform transform hover:scale-105 mb-4">
                        Start Next Wave
                    </button>
                    <button id="main-menu-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg text-sm">
                        Change Category
                    </button>
                </div>
            </div>
            <!-- Stats Display -->
            <div class="flex flex-wrap justify-around items-center mb-6 bg-gray-900/50 p-4 rounded-lg text-center border border-gray-700 gap-4">
                <div>
                    <div class="text-sm font-medium text-gray-400">Wave</div>
                    <div id="wave" class="text-2xl font-bold text-purple-400">1</div>
                </div>
                <div>
                    <div class="text-sm font-medium text-gray-400">Time</div>
                    <div id="timer" class="text-2xl font-bold text-blue-400">0s</div>
                </div>
                <div>
                    <div class="text-sm font-medium text-gray-400">WPM</div>
                    <div id="wpm" class="text-2xl font-bold text-green-400">0</div>
                </div>
                <div>
                    <div class="text-sm font-medium text-gray-400">Accuracy</div>
                    <div id="accuracy" class="text-2xl font-bold text-red-400">100%</div>
                </div>
            </div>
        </div>

        <!-- Category Selection Screen (initially shown) -->
        <div id="category-selection-container">
             <p class="text-center text-gray-400 mb-6">Select a category to begin.</p>
             <div class="category-grid">
                <button data-category="movies" class="category-btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">Movies</button>
                <button data-category="books" class="category-btn bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">Books</button>
                <button data-category="tv" class="category-btn bg-sky-600 hover:bg-sky-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">TV Shows</button>
                <button data-category="poetry" class="category-btn bg-rose-600 hover:bg-rose-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">Poetry</button>
                <button data-category="famous" class="category-btn bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">Famous Quotes</button>
                <button data-category="misc" class="category-btn bg-slate-600 hover:bg-slate-700 text-white font-bold py-4 px-2 rounded-lg shadow-lg transition-transform transform hover:scale-105">Miscellaneous</button>
             </div>
        </div>
        
        <input type="text" id="input-field" class="opacity-0 absolute w-0 h-0" autofocus>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const mainGameContainer = document.getElementById('main-game-container');
            const categorySelectionContainer = document.getElementById('category-selection-container');
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const inputField = document.getElementById('input-field');
            const timerEl = document.getElementById('timer');
            const wpmEl = document.getElementById('wpm');
            const accuracyEl = document.getElementById('accuracy');
            const nextWaveBtn = document.getElementById('next-wave-btn');
            const mainMenuBtn = document.getElementById('main-menu-btn');
            const waveClearedOverlay = document.getElementById('wave-cleared-overlay');
            const waveEl = document.getElementById('wave');
            const waveClearedTitle = document.getElementById('wave-cleared-title');
            const categoryButtons = document.querySelectorAll('.category-btn');

            const sentencesByCategory = {
                movies: {
                    easy: ["I'll be back.", "My precious.", "Why so serious?", "May the Force be with you."],
                    medium: ["Here's looking at you, kid.", "I'm the king of the world!", "You're gonna need a bigger boat."],
                    hard: ["You either die a hero, or you live long enough to see yourself become the villain.", "Louis, I think this is the beginning of a beautiful friendship."]
                },
                books: {
                    easy: ["It is a truth universally acknowledged.", "Call me Ishmael.", "So it goes."],
                    medium: ["It was a bright cold day in April, and the clocks were striking thirteen.", "The creatures outside looked from pig to man, and from man to pig again."],
                    hard: ["So we beat on, boats against the current, borne back ceaselessly into the past.", "You never really understand a person until you consider things from his point of view."]
                },
                tv: {
                    easy: ["How you doin'?", "Winter is coming.", "Bazinga!", "D'oh!"],
                    medium: ["Bears, beets, Battlestar Galactica.", "I am the one who knocks.", "Clear eyes, full hearts, can't lose."],
                    hard: ["The Lannisters send their regards.", "I wish there was a way to know you're in the good old days before you've actually left them."]
                },
                poetry: {
                    easy: ["The woods are lovely, dark and deep,", "I am the master of my fate:", "So much depends upon a red wheel barrow."],
                    medium: ["Two roads diverged in a wood, and I— I took the one less traveled by.", "Because I could not stop for Death – He kindly stopped for me –"],
                    hard: ["Once upon a midnight dreary, while I pondered, weak and weary,", "Do not go gentle into that good night, Old age should burn and rave at close of day;"]
                },
                famous: {
                    easy: ["The time is always right to do what is right.", "Ask not what your country can do for you.", "I have a dream."],
                    medium: ["The only thing we have to fear is fear itself.", "That's one small step for a man, one giant leap for mankind."],
                    hard: ["The unexamined life is not worth living.", "Success is not final, failure is not fatal: it is the courage to continue that counts."]
                },
                misc: {
                    easy: ["The quick brown fox jumps over the lazy dog.", "Pack my box with five dozen liquor jugs."],
                    medium: ["How vexingly quick daft zebras jump.", "The five boxing wizards jump quickly."],
                    hard: ["A wizard's job is to vex chumps quickly in fog.", "Sphinx of black quartz, judge my vow."]
                }
            };

            // Game State
            let selectedCategory = 'movies';
            let waveNumber = 1;
            let currentSentence = '';
            let targets = [];
            let lasers = [];
            let particles = [];
            let player = { x: 0, y: 0, targetX: 0, width: 50, height: 20, color: '#60a5fa' };
            let currentIndex = 0;
            let startTime = null;
            let timerInterval = null;
            
            class Laser { constructor(x, y, color) { this.x = x; this.y = y; this.width = 4; this.height = 15; this.color = color; this.velocity = { y: -8 }; } draw() { ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.width, this.height); } update() { this.draw(); this.y += this.velocity.y; } }
            class Particle { constructor(x, y, radius, color, velocity) { this.x = x; this.y = y; this.radius = radius; this.color = color; this.velocity = velocity; this.alpha = 1; } draw() { ctx.save(); ctx.globalAlpha = this.alpha; ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false); ctx.fillStyle = this.color; ctx.fill(); ctx.restore(); } update() { this.draw(); this.x += this.velocity.x; this.y += this.velocity.y; this.alpha -= 0.02; } }

            const getNewSentence = () => {
                const category = sentencesByCategory[selectedCategory];
                let sentenceList;
                if (waveNumber <= 2) sentenceList = category.easy;
                else if (waveNumber <= 5) sentenceList = category.medium;
                else sentenceList = category.hard;
                return sentenceList[Math.floor(Math.random() * sentenceList.length)];
            };

            const setupTargets = () => {
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;
                player.y = canvas.height - 30;
                targets = [];
                currentSentence = getNewSentence();
                const words = currentSentence.split(' ');
                let fontSize = 22;
                if (canvas.width < 768) fontSize = 18;
                if (canvas.width < 480) fontSize = 14;
                ctx.font = `${fontSize}px "Press Start 2P"`;
                const padding = canvas.width * 0.05;
                let currentX = padding;
                let currentY = 50;
                const letterSpacing = 4;
                const spaceWidth = ctx.measureText(' ').width + letterSpacing;
                const lineHeight = fontSize * 2.2;
                words.forEach((word, wordIndex) => {
                    const wordWidth = ctx.measureText(word).width + (Math.max(0, word.length - 1)) * letterSpacing;
                    if (currentX + wordWidth > canvas.width - padding && currentX > padding) { currentX = padding; currentY += lineHeight; }
                    word.split('').forEach(char => { const charWidth = ctx.measureText(char).width; targets.push({ char, x: currentX, y: currentY, width: charWidth, isHit: false, color: '#e5e7eb' }); currentX += charWidth + letterSpacing; });
                    if (wordIndex < words.length - 1) { targets.push({ char: ' ', x: currentX, y: currentY, width: ctx.measureText(' ').width, isHit: false, color: '#e5e7eb' }); currentX += spaceWidth; }
                });
                const lines = {};
                targets.forEach(target => { if (!lines[target.y]) lines[target.y] = []; lines[target.y].push(target); });
                for (const y in lines) {
                    const lineTargets = lines[y];
                    const lastTarget = lineTargets[lineTargets.length - 1];
                    const firstTarget = lineTargets[0];
                    const lineWidth = (lastTarget.x + lastTarget.width) - firstTarget.x;
                    const lineStartX = (canvas.width - lineWidth) / 2;
                    const xOffset = lineStartX - firstTarget.x;
                    lineTargets.forEach(target => { target.x += xOffset; });
                }
                currentSentence = targets.map(t => t.char).join('');
                if (targets.length > 0) { const firstTarget = targets[0]; player.x = firstTarget.x + firstTarget.width / 2; player.targetX = player.x; }
            };
            
            const createExplosion = (target) => { for (let i = 0; i < 15; i++) { particles.push(new Particle(target.x + target.width / 2, target.y, Math.random() * 3, `hsl(${Math.random() * 60 + 180}, 50%, 50%)`, { x: (Math.random() - 0.5) * (Math.random() * 6), y: (Math.random() - 0.5) * (Math.random() * 6) })); } };

            const animate = () => {
                requestAnimationFrame(animate);
                ctx.fillStyle = 'rgba(12, 10, 9, 0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                player.x += (player.targetX - player.x) * 0.1;
                ctx.fillStyle = player.color;
                ctx.beginPath();
                ctx.moveTo(player.x, player.y);
                ctx.lineTo(player.x - player.width / 2, player.y + player.height);
                ctx.lineTo(player.x + player.width / 2, player.y + player.height);
                ctx.closePath();
                ctx.fill();
                targets.forEach((target, index) => { if (!target.isHit) { ctx.fillStyle = (index === currentIndex) ? '#3b82f6' : target.color; ctx.fillText(target.char, target.x, target.y); } });
                particles.forEach((p, i) => p.alpha <= 0 ? particles.splice(i, 1) : p.update());
                lasers.forEach((l, i) => l.y < 0 ? lasers.splice(i, 1) : l.update());
            };

            const resetWave = () => {
                waveClearedOverlay.classList.remove('show');
                clearInterval(timerInterval);
                timerInterval = null;
                startTime = null;
                currentIndex = 0;
                player.color = '#60a5fa';
                waveEl.innerText = waveNumber;
                setupTargets();
                inputField.focus();
            };

            const startNextWave = () => { waveNumber++; resetWave(); };
            const startTimer = () => { startTime = new Date(); timerInterval = setInterval(() => { const elapsedTime = Math.floor((new Date() - startTime) / 1000); timerEl.innerText = `${elapsedTime}s`; calculateWPM(elapsedTime); }, 1000); };
            const calculateWPM = (time) => { if (time === 0) return; const wpm = Math.round(((currentIndex) / 5) / (time / 60)); wpmEl.innerText = wpm > 0 ? wpm : 0; };
            const calculateAccuracy = () => { accuracyEl.innerText = '100%'; }; // Simplified for now

            const showMainMenu = () => {
                mainGameContainer.classList.add('hidden');
                categorySelectionContainer.classList.remove('hidden');
            };

            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    selectedCategory = button.dataset.category;
                    waveNumber = 1;
                    categorySelectionContainer.classList.add('hidden');
                    mainGameContainer.classList.remove('hidden');
                    resetWave();
                });
            });

            inputField.addEventListener('input', (e) => {
                if (currentIndex >= targets.length) return;
                if (!startTime) startTimer();
                const typedChar = e.target.value;
                const currentTarget = targets[currentIndex];
                if (typedChar === currentTarget.char) {
                    player.color = '#4ade80';
                    currentTarget.isHit = true;
                    lasers.push(new Laser(player.x - 2, player.y, '#fde047'));
                    createExplosion(currentTarget);
                    currentIndex++;
                    if (currentIndex < targets.length) {
                        const nextTarget = targets[currentIndex];
                        player.targetX = nextTarget.x + nextTarget.width / 2;
                    } else {
                        clearInterval(timerInterval);
                        waveClearedTitle.innerText = `Wave ${waveNumber} Cleared!`;
                        waveClearedOverlay.classList.add('show');
                        nextWaveBtn.focus();
                    }
                } else {
                    player.color = '#f87171';
                }
                inputField.value = '';
                setTimeout(() => { if (player.color !== '#4ade80') player.color = '#60a5fa'; }, 200);
            });

            inputField.addEventListener('keydown', (e) => { if (e.key === 'Backspace') e.preventDefault(); });
            nextWaveBtn.addEventListener('click', startNextWave);
            mainMenuBtn.addEventListener('click', showMainMenu);
            
            animate();
            inputField.focus();
            window.addEventListener('resize', () => { if (!mainGameContainer.classList.contains('hidden')) { resetWave(); } });
        });
    </script>
</body>
</html>

